
Red Wine Quality Analysis by David Blum
=================================



What makes a wine great? Paulo Cortez compiled a dataset consisting of objective
tests (including pH and chemical composition) and sensory data (taste ratings by
experts). The goal of is this analysis is to illuminate what chemical and 
physical properties make wine taste good.


```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
setwd('/home/david/Desktop/DataAnalysisProjects/RedWineData')
redwines_full <- read.csv('wineQualityReds.csv')
library(ggplot2)
library(GGally)
library(plyr)
library(gridExtra)
library(grid)
library(psych)
library(corrplot)
```

## Explore the Dataset


```{r echo=FALSE, Load_the_Data}

# Take out count from redwines_full
redwines <- subset(redwines_full, select = -c(X))

# List structure of redwines
str(redwines)

```

The dataset consists of 1599 red wines, with 12 variables. Eleven variables are 
chemical/physical and one variable is sensory (quality). 


Explanation of variables as per [Cortez et al., 2009]:

1. fixed.acidity - (tartaric acid: g / dm^3) - most acids involved with wine or 
fixed or nonvolatile
  
2. volatile.acidity - (acetic acid: g / dm^3) - the amount of acetic acid in 
wine, which at too high of levels can lead to an unpleasant, vinegar taste

3. citric.acid - (g / dm^3) - found in small quantities, citric acid can add 
'freshness' and flavor to wines

4. residual.sugar - (g / dm^3) - the amount of sugar remaining after 
fermentation stops, it's rare to find wines with less than 1 gram/liter and 
wines with greater than 45 grams/liter are considered sweet

5. chlorides - (sodium chloride: g / dm^3) - the amount of salt in the wine
  
6. free.sulfur.dioxide - (mg / dm^3) - the free form of SO2 exists in 
equilibrium between molecular SO2 (as a dissolved gas) and bisulfite ion; it 
prevents microbial growth and the oxidation of wine

7. total.sulfur.dioxide - (mg / dm^3) - amount of free and bound forms of S02; 
in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 
concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine

8. density - (g / cm^3) - the density of water is close to that of water 
depending on the percent alcohol and sugar content

9. pH - describes how acidic or basic a wine is on a scale from 0 (very acidic) 
to 14 (very basic); most wines are between 3-4 on the pH scale

10. sulphates (potassium sulphate: g / dm^3) - a wine additive which can 
contribute to sulfur dioxide gas (S02) levels, which acts as an antimicrobial 
and antioxidant

11. alcohol (% by volume) - the percent alcohol content of the wine

12. quality (scored 0-10)


## Univariate Exploration and Plots



```{r echo=FALSE, Load_Univariate_Functions}

# generates single-variable redwines ggplot
create_plot <- function(varname) {
  return(ggplot(aes_string(x = varname), data = redwines))
}

# creates single-variable histogram
create_hist <- function(varname, binwidth = .1) {
  create_plot(varname) + geom_histogram(binwidth = binwidth)
}

```

*All Univariate Plots created have a binwidth = .1 unless otherwise stated

```{r}
create_hist('fixed.acidity')
summary(redwines[1])
```

The plot of fixed.acidity is right-tailed and has range = [4.6, 15.9]. 
A majority of the data exists on the interval [7.1, 9.2]. 

```{r}
create_hist('volatile.acidity', 0.02)
summary(redwines[2])
```

The plot of volatile.acidity is slighty right-tailed and has two peaks.
It has a range of [.12, 1.58] with most values between [.39, .64]. 

*binwidth = .02

```{r}
create_hist('citric.acid', 0.01)
summary(redwines[3])
```

The plot of citric.acid showcases many wines contain little to no citric acid,
however the graph has no visible peak or tail. It has a range = [0, 1].

*binwidth = .01

```{r}
create_hist('residual.sugar')
create_hist('residual.sugar', .02) + scale_x_log10() + annotation_logticks()
summary(redwines[4])
```

The plot of residual.sugar is right-tailed with one peak. The range = [.9, 15.5]
with most values appearing to be withing [1.9, 2.6].

Data was transformed to further inspect the peak and tail. The appear to be no
large change from the initial inspection.

*Transformed data has a binwidth = .02

```{r}
create_hist('chlorides', 0.01)
create_hist('chlorides', 0.01) + scale_x_log10() + annotation_logticks()
summary(redwines[5])
```

The plot for chlorides has one peak and is right-tailed. Range = [.012, .611] 
with most data values between [.07, .09]. 

Transformed data still showcases 1 peak, however it no longer appears to be 
right-tailed. There's a apparent even distribution.

*binwidth = .01 for both graphs

```{r}
create_hist('free.sulfur.dioxide', 1)
create_hist('free.sulfur.dioxide') + scale_x_log10() + annotation_logticks()
summary(redwines[6])
```

The plot for free.sulfur.dioxide is right-tailed with one peak. Range [1, 72] 
with most values between [7, 21]. 

The transformed plot has a large dip at 8 which is a bit odd. Otherwise it has
a wide peak with with short tails.

*binwidth = 1 (not-trandformed)

```{r}
create_hist('total.sulfur.dioxide', 5)
create_hist('total.sulfur.dioxide', .1) + scale_x_log10() + annotation_logticks()
summary(redwines[7])
```

The plot for total.sulfur.dioxide has one peak and is heavily right-tailed. The
range = [6, 289] with most values between [22, 62]. 

Tranformed data has an apparent normal distribution. 

*binwidth = 1 (not-trandformed)

```{r}
create_hist('density', .0005)
summary(redwines[8])
```

The plot for density is normally distrubted. The range = [.9901, 1.0037] with 
most values between [.9956, .9978]. For reference alcohol has a density ~.789 
g / cm^3.

*binwidth = .005

```{r}
create_hist('pH', 0.05)
summary(redwines[9])
```

The plot for pH is normally distrubted. The range = [2.74, 4.01] with 
most values between [3.21, 3.40]. 

*binwidth = .005

```{r}
create_hist('sulphates', 0.05)
create_hist('sulphates', 0.05) + scale_x_log10() + annotation_logticks()
summary(redwines[10])
```


The plot for sulphates has one peak and is right-tailed. The range = [.33, 2] 
with most values between [.55, .73]. 

Tranformed data has an apparent normal distribution and is slightly 
right-tailed. 

*binwidth = .05 (not-trandformed) and binwidth = .05 (transformed)

```{r}
create_hist('alcohol')
create_hist('alcohol', .01) + scale_x_log10() + annotation_logticks()
summary(redwines[11])
```

The plot for alcohol has generally one peak and is right-tailed. The range = 
[8.4, 14.9] with most values between [9.5, 11.1]. 

Tranformed data has the same characteristics as the not-transformed graph.

*binwidth = .01 (transformed)

```{r}
create_hist('quality', 1)
summary(redwines[12])
```

The plot for quality is normally distrubuted. The range = [3, 8] with most 
values between [5,6]. This is a bit peculiar because wines were rated on a scale
of 1-10. No wines rated below a 3 or above an 8.

*binwidth = 1


## Univariate Analysis

Most plots have a single peak and are right-tailed. In general the transformed
plots didn't reveal any interesting analysis. 

The most intesting note was although wines were scaled from 0-10 the lowest 
given score is a 3 and the highest an 8. Most wines were given a score of 5 or 
6.

From descriptions via [Cortez et al., 2009] and my own personal bias I am paying 
particular attention to certain variables:

* volatile acidity - Can lead to an unpleasant vinegar taste at high levels
* citric acid - if added can lead to pleasant taste
* total.sulfur.dioxide - at high levels is evident in nose and taste
* alcohol - I'm curious to see how this affects quality


## Bivariate Plots

Although the goal is to compare everything to quality let's first explore the
correllation plots. 

##### Correllation Plots

```{r echo=FALSE, message=FALSE, warning=FALSE}
redwines_corr <- cor(redwines)
corrplot(redwines_corr, type='lower')
```


The bottom row of quality is where I'm looking. It appears to have a 
moderately negative correlation with volatile.acidity (red) and a moderately 
postive correlation with alcohol (blue). I am suprised to see both citric.acid
and total.sulfur.dioxide are not very significant.



### Variables versus 'quality'

```{r echo=FALSE, message=FALSE, warning=FALSE}
# subset quality with volatile.acidity
redwines.sub <- redwines[, c(2,11,12)]
pairs.panels(redwines.sub)
```

The correlation coefficients are:

volatile.acidity to quality: -0.39
alcohol to quality : 0.48

Both coefficients showcase a moderate significance to affecting quality.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Change quality to a factor to categorize values
redwines$quality <- as.factor(redwines$quality)

ggplot(redwines, aes(quality, alcohol)) +
  geom_boxplot()

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(quality, volatile.acidity)) +
  geom_boxplot()

```

Neither volatile.acidity or alcohol are strongly correlated with quality, 
however splitting data by quality yields some interesting reults. Looking at the
boxplots higher quality alcohol typically has more alcohol and lower volatile 
acidity. 

How do the other plots compare to quality?

```{r echo=FALSE, message=FALSE, warning=FALSE}
redwines.sub <- redwines[, c(3,4,5,6,7,8,9,10,12)]
pairs.panels(redwines.sub)
```


In the above image the bivarate graphs vs quailty are on the bottom row and the 
correlltion coefficients are the rightmost column.

As viewed in the right column, none of the other variables have any sort of 
significant correlation with quality (all have a magnitude <.3). 

Where else is there to inspect? Let's take a closer look at what's strongly 
correlated with both volatile.acidity and alcohol (density, citric.acid, and pH)
as well as sulphates (quality correlation = .25).

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(quality, citric.acid)) +
  geom_boxplot()
```

Higher quality wines generally have higher than .3 g/dm^3 of citric acid. Interesting.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(quality, density)) +
  geom_boxplot()
```

Wines with extreme densities (outliers) appear to be mid quality wines. The 
highest quality wines typically have a lower density (likely due to the 
correlation with alcohol which has a density = ~.789 g/dm^3).

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(quality, pH)) +
  geom_boxplot()
```

There doesn't appear to be anything too interesting here. High quality wines 
have somewhat lower pH, but no strong observations can be made.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(quality, log10(sulphates))) +
  geom_boxplot()
```

The median values of sulphates increase slightly as quality increases. The 
log10 scale makes the correlation more apparent.


## Non-Feature Bivarate Plots

The only feature being observed is quality, however there are intestering 
relationships between other features that I would like to explore.


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(alcohol, density)) +
  geom_jitter() +
  geom_smooth(method = 'auto')
```

As alcohol increases density decreases. Alcohol appears to have a lower density 
than the average wine.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(volatile.acidity, citric.acid)) +
  geom_jitter() +
  geom_smooth(method = 'glm') +
  scale_y_continuous(limits = c(0, 1))
```

There is a definitely negative correlation with citric.acid and 
volatile.acidity. I wonder how this corresponds to quality?


## Bivariate Analysis

The variables that affect quality the most are alcohol and volatile.acidity. 
Their corellation coeffients are: 

volatile.acidity to quality: -0.39
alcohol to quality : 0.48

Both variables are not strongly significant, at best they have a moderate 
influence on quality with alcohol having the higher impact. The reason 
volatile.acidity is low is likely due to high amounts lead to an unpleasant
vinegar taste. Alcohol does have a taste, but I'm curious as to the positive 
correlation. The only variable that is also given as information on the label is
alcohol; I wonder if the taste experts were able to read alcohol content on the 
label during tasting and how that affected their rating of the wine.

Minor significance can be found with citric.acid and sulphates (each with 
corellation coefficients ~.24). Citric acid can add 'freshness' to wine which is
likely the cause for a positive correlation whereas sulphates act as an 
antrimicrobial and antioxidant.

From the variable description I was suprised not to see a strong or moderate 
correlation with total.sulfur.dioxide. It is described as having a strong odor 
and taste at high levels which I thought would affect the rating.

Other non-feature variables were compared that showed strong correlation with
eachother. Both alcohol and density have a negative correlation likely due to
alcohol having a lower than average density than most wines. I do not know 
how citric and acetic acid affect one another chemically, however the results
show a negative correlation with citric.acid and volatile.acidity (acetic acid).


# Multivariate Plots

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(y = volatile.acidity, x = alcohol), data = redwines) +
  geom_jitter(aes(color = quality)) +
  scale_color_brewer(type='qual')
```

High quality wines (quality = 7 or 8) generally have low volatile.acidity (below
.5) and high amounts of alcohol (above 10%). It appears much of the quality = 5 
wines have very low alcohol and a high range of volatile acidity.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(alcohol, density)) +
  geom_point(aes(color = quality)) +
  scale_color_brewer(type='qual')
```

High quality wines appear to range all across the scale with most quality >= 6 
wines containing higher amounts of alcohol. Most of the lower quality wines tend
to have density values = [.995, 1.0] while also containing low amounts of 
alcohol.


```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(volatile.acidity, citric.acid)) +
  geom_point(aes(color = quality)) +
  scale_color_brewer(type='qual')
```

There is a very apparent cluster of quality = 7 wines with moderate levels of
citric.acid and low amounts of volatile.acidity (below .5). Higher tier alcohols
generally have higher amounts of citric.acid and lower amounts of 
volatile.acidity.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(redwines, aes(alcohol, citric.acid)) +
  geom_point(aes(color = quality)) +
  scale_color_brewer(type='qual')
```

Higher quality alcohols generally have citric.acid concentraions higher than 
.25 g/dm^3 and more the 10% alcohol. That region is mostly composed of quality 
6, 7, and 8. 

# Multivariate Analysis

Wines of high quality tend to follow a few rules:

1) Percent Alcohol above 10%
2) Volatile Acidity (acetic acid) below .4 g/dm^3
3) Citric Adid above .25 g/dm^3

It's not a guarentee for wines that meet these specifications will be of high
quality, however it appears to be a good indicator.


# Final Plots 


# Reflection


# References

  P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. 
  Modeling wine preferences by data mining from physicochemical properties.
  In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

  Available at: [@Elsevier] http://dx.doi.org/10.1016/j.dss.2009.05.016
                [Pre-press (pdf)] http://www3.dsi.uminho.pt/pcortez/winequality09.pdf
                [bib] http://www3.dsi.uminho.pt/pcortez/dss09.bib